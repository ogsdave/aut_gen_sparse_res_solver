function[indicesToRemove, numOfRedCoeffMat, zeigvalindx, solverTemplate, extendedbasis, nullspacesize1, depdXcols1, nzrows1, depdCcols1, indepdCcols1, mdepdXcols1, mindepdXcols1, indepdCrows1, rowstorem1, nullspacesize2, depdXcols2, nzrows2, depdCcols2, indepdCcols2, mdepdXcols2, mindepdXcols2, indepdCrows2, rowstorem2, nullspacesize3, depdXcols3, nzrows3, depdCcols3, indepdCcols3, mdepdXcols3, mindepdXcols3, indepdCrows3, rowstorem3] = reducemonbasis(data, noofdatacoeff, foldername)
hiddenvarnumber = 5;
for i = 1:length(data)
eval(strjoin({'c',num2str(i),' = ', 'data(',num2str(i),');'},''));
end
t1 = c1*c17+c18*c2+c19*c3;
t2 = c1*c21+c17*c5+c18*c6+c19*c7+c2*c22+c23*c3;
t3 = c1*c25+c10*c18+c11*c19+c17*c9+c2*c26+c27*c3;
t4 = c1*c29+c13*c17+c14*c18+c15*c19+c2*c30+c3*c31;
t5 = c21*c5+c22*c6+c23*c7;
t6 = c10*c22+c11*c23+c21*c9+c25*c5+c26*c6+c27*c7;
t7 = c13*c21+c14*c22+c15*c23+c29*c5+c30*c6+c31*c7;
t8 = c10*c26+c11*c27+c25*c9;
t9 = c10*c30+c11*c31+c13*c25+c14*c26+c15*c27+c29*c9;
t10 = c13*c29+c14*c30+c15*c31;
t11 = c13*c61+c14*c62+c15*c63;
t12 = c1*c61+c13*c33+c14*c34+c15*c35+c2*c62+c3*c63;
t13 = c13*c37+c14*c38+c15*c39+c5*c61+c6*c62+c63*c7;
t14 = c10*c62+c11*c63+c13*c41+c14*c42+c15*c43+c61*c9;
t15 = c13*c57+c14*c58+c15*c59;
t16 = c1*c45+c2*c46+c3*c47;
t17 = c1*c57+c13*c45+c14*c46+c15*c47+c2*c58+c3*c59;
t18 = c49*c5+c50*c6+c51*c7;
t19 = c13*c49+c14*c50+c15*c51+c5*c57+c58*c6+c59*c7;
t20 = c10*c54+c11*c55+c53*c9;
t21 = c10*c58+c11*c59+c13*c53+c14*c54+c15*c55+c57*c9;
t22 = c1*c37+c2*c38+c3*c39+c33*c5+c34*c6+c35*c7;
t23 = c1*c41+c10*c34+c11*c35+c2*c42+c3*c43+c33*c9;
t24 = c10*c38+c11*c39+c37*c9+c41*c5+c42*c6+c43*c7;
t25 = c1*c53+c10*c46+c11*c47+c2*c54+c3*c55+c45*c9;
t26 = c10*c50+c11*c51+c49*c9+c5*c53+c54*c6+c55*c7;
t27 = c1*c49+c2*c50+c3*c51+c45*c5+c46*c6+c47*c7;
t28 = c1*c33+c2*c34+c3*c35;
t29 = c37*c5+c38*c6+c39*c7;
t30 = c10*c42+c11*c43+c41*c9;
t31 = c29*c61+c30*c62+c31*c63;
t32 = c17*c61+c18*c62+c19*c63+c29*c33+c30*c34+c31*c35;
t33 = c21*c61+c22*c62+c23*c63+c29*c37+c30*c38+c31*c39;
t34 = c25*c61+c26*c62+c27*c63+c29*c41+c30*c42+c31*c43;
t35 = c29*c57+c30*c58+c31*c59;
t36 = c17*c45+c18*c46+c19*c47;
t37 = c17*c57+c18*c58+c19*c59+c29*c45+c30*c46+c31*c47;
t38 = c21*c49+c22*c50+c23*c51;
t39 = c21*c57+c22*c58+c23*c59+c29*c49+c30*c50+c31*c51;
t40 = c25*c53+c26*c54+c27*c55;
t41 = c25*c57+c26*c58+c27*c59+c29*c53+c30*c54+c31*c55;
t42 = c17*c37+c18*c38+c19*c39+c21*c33+c22*c34+c23*c35;
t43 = c17*c41+c18*c42+c19*c43+c25*c33+c26*c34+c27*c35;
t44 = c21*c41+c22*c42+c23*c43+c25*c37+c26*c38+c27*c39;
t45 = c17*c53+c18*c54+c19*c55+c25*c45+c26*c46+c27*c47;
t46 = c21*c53+c22*c54+c23*c55+c25*c49+c26*c50+c27*c51;
t47 = c17*c49+c18*c50+c19*c51+c21*c45+c22*c46+c23*c47;
t48 = c17*c33+c18*c34+c19*c35;
t49 = c21*c37+c22*c38+c23*c39;
t50 = c25*c41+c26*c42+c27*c43;
t51 = c1^2-c17^2-c18^2-c19^2+c2^2+c3^2;
t52 = 2*c1*c5-2*c17*c21-2*c18*c22-2*c19*c23+2*c2*c6+2*c3*c7;
t53 = 2*c1*c9+2*c10*c2+2*c11*c3-2*c17*c25-2*c18*c26-2*c19*c27;
t54 = 2*c1*c13+2*c14*c2+2*c15*c3-2*c17*c29-2*c18*c30-2*c19*c31;
t55 = -c21^2-c22^2-c23^2+c5^2+c6^2+c7^2;
t56 = 2*c10*c6+2*c11*c7-2*c21*c25-2*c22*c26-2*c23*c27+2*c5*c9;
t57 = 2*c13*c5+2*c14*c6+2*c15*c7-2*c21*c29-2*c22*c30-2*c23*c31;
t58 = c10^2+c11^2-c25^2-c26^2-c27^2+c9^2;
t59 = 2*c10*c14+2*c11*c15+2*c13*c9-2*c25*c29-2*c26*c30-2*c27*c31;
t60 = c13^2+c14^2+c15^2-c29^2-c30^2-c31^2;
M = zeros(5,21);
M(1,7) = t8;
M(1,9) = t3;
M(1,11) = t1;
M(1,12) = t6;
M(1,14) = t2;
M(1,15) = t5;
M(1,16) = t9;
M(1,18) = t4;
M(1,19) = t7;
M(1,21) = t10;
M(2,1) = t20;
M(2,2) = t25;
M(2,3) = t16;
M(2,4) = t26;
M(2,5) = t27;
M(2,6) = t18;
M(2,7) = t30;
M(2,8) = t21;
M(2,9) = t23;
M(2,10) = t17;
M(2,11) = t28;
M(2,12) = t24;
M(2,13) = t19;
M(2,14) = t22;
M(2,15) = t29;
M(2,16) = t14;
M(2,17) = t15;
M(2,18) = t12;
M(2,19) = t13;
M(2,21) = t11;
M(3,1) = t40;
M(3,2) = t45;
M(3,3) = t36;
M(3,4) = t46;
M(3,5) = t47;
M(3,6) = t38;
M(3,7) = t50;
M(3,8) = t41;
M(3,9) = t43;
M(3,10) = t37;
M(3,11) = t48;
M(3,12) = t44;
M(3,13) = t39;
M(3,14) = t42;
M(3,15) = t49;
M(3,16) = t34;
M(3,17) = t35;
M(3,18) = t32;
M(3,19) = t33;
M(3,21) = t31;
M(4,7) = t58;
M(4,9) = t53;
M(4,11) = t51;
M(4,12) = t56;
M(4,14) = t52;
M(4,15) = t55;
M(4,16) = t59;
M(4,18) = t54;
M(4,19) = t57;
M(4,21) = t60;
M(5,16) = 1;
M(5,20) = -1;
M = [rref(M(1:0,:)); M(1:end,:)];
ncinds = [2, 3, 7, 8, 12, 13, 17, 18, 22, 23, 27, 28, 31, 32, 33, 34, 37, 38, 41, 42, 43, 44, 47, 48, 51, 52, 53, 54, 56, 57, 58, 59, 62, 63, 66, 67, 68, 69, 71, 72, 73, 74, 76, 77, 78, 79, 82, 83, 86, 87, 88, 89, 91, 92, 93, 94, 101, 102, 103, 104];
for ncind = 1:60
    eval(strjoin({'nc', num2str(ncind), ' = ', 'M(ncinds(ncind));'}, '') )
end
ArrayOfCsNames = '';
sizeOfC = 70;
noOfVars = 5;
sparseBasis = [0 0 1 1 1 1 1 1 2 2 2 2 2 2 3 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 3 3 3 3 4 4; 1 1 0 0 1 1 1 1 0 0 0 1 1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 0 0 0 1 1 1 0 0 1 1 0 1; 2 3 1 2 0 1 1 2 0 0 1 0 0 1 0 0 0 0 0 0 0 1 1 1 1 2 2 2 3 3 4 0 0 0 0 0 1 1 1 1 2 2 3 4 0 0 0 0 1 1 2 3 0 0 0 1 2 3 0 1 2 0 1 2 0 1 0 1 0 0; 1 0 1 0 2 0 1 0 0 1 0 0 1 0 0 0 0 1 2 3 4 0 1 2 3 0 1 2 0 1 0 0 1 2 3 4 0 1 2 3 0 2 1 0 0 1 2 3 0 2 1 0 0 1 3 2 1 0 2 1 0 2 1 0 1 0 1 0 0 0;];
solFromEigenVectors = [-4 -1 -2 -1; 3 1 2 1; 0 -1 0 0; 0 0 0 0; 2 1 1 1; -1 0 -1 -1; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0; 0 0 0 0;];
Cs = zeros(70,140);
Cs(1,9) = nc13;
Cs(1,17) = nc57;
Cs(1,18) = nc53;
Cs(1,19) = nc39;
Cs(1,22) = nc49;
Cs(1,23) = nc35;
Cs(1,26) = nc25;
Cs(1,45) = nc43;
Cs(1,46) = nc29;
Cs(1,49) = nc19;
Cs(2,3) = nc19;
Cs(2,10) = nc13;
Cs(2,18) = nc57;
Cs(2,19) = nc53;
Cs(2,20) = nc39;
Cs(2,23) = nc49;
Cs(2,24) = nc35;
Cs(2,27) = nc25;
Cs(2,46) = nc43;
Cs(2,47) = nc29;
Cs(3,19) = nc57;
Cs(3,20) = nc53;
Cs(3,21) = nc39;
Cs(3,24) = nc49;
Cs(3,25) = nc35;
Cs(3,28) = nc25;
Cs(3,47) = nc43;
Cs(3,48) = nc29;
Cs(3,50) = nc19;
Cs(3,59) = nc13;
Cs(4,3) = nc29;
Cs(4,4) = nc19;
Cs(4,11) = nc13;
Cs(4,22) = nc57;
Cs(4,23) = nc53;
Cs(4,24) = nc39;
Cs(4,26) = nc49;
Cs(4,27) = nc35;
Cs(4,29) = nc25;
Cs(4,49) = nc43;
Cs(5,3) = nc43;
Cs(5,23) = nc57;
Cs(5,24) = nc53;
Cs(5,25) = nc39;
Cs(5,27) = nc49;
Cs(5,28) = nc35;
Cs(5,30) = nc25;
Cs(5,50) = nc29;
Cs(5,51) = nc19;
Cs(5,60) = nc13;
Cs(6,4) = nc43;
Cs(6,26) = nc57;
Cs(6,27) = nc53;
Cs(6,28) = nc39;
Cs(6,29) = nc49;
Cs(6,30) = nc35;
Cs(6,31) = nc25;
Cs(6,51) = nc29;
Cs(6,52) = nc19;
Cs(6,61) = nc13;
Cs(7,6) = nc19;
Cs(7,12) = nc13;
Cs(7,32) = nc57;
Cs(7,33) = nc53;
Cs(7,34) = nc39;
Cs(7,37) = nc49;
Cs(7,38) = nc35;
Cs(7,41) = nc25;
Cs(7,53) = nc43;
Cs(7,54) = nc29;
Cs(8,1) = nc25;
Cs(8,5) = nc29;
Cs(8,7) = nc19;
Cs(8,13) = nc13;
Cs(8,33) = nc57;
Cs(8,34) = nc53;
Cs(8,35) = nc39;
Cs(8,38) = nc49;
Cs(8,39) = nc35;
Cs(8,54) = nc43;
Cs(9,5) = nc43;
Cs(9,34) = nc57;
Cs(9,35) = nc53;
Cs(9,36) = nc39;
Cs(9,39) = nc49;
Cs(9,40) = nc35;
Cs(9,42) = nc25;
Cs(9,55) = nc29;
Cs(9,56) = nc19;
Cs(9,62) = nc13;
Cs(10,1) = nc35;
Cs(10,2) = nc25;
Cs(10,6) = nc43;
Cs(10,7) = nc29;
Cs(10,8) = nc19;
Cs(10,14) = nc13;
Cs(10,37) = nc57;
Cs(10,38) = nc53;
Cs(10,39) = nc39;
Cs(10,41) = nc49;
Cs(11,1) = nc49;
Cs(11,7) = nc43;
Cs(11,38) = nc57;
Cs(11,39) = nc53;
Cs(11,40) = nc39;
Cs(11,42) = nc35;
Cs(11,43) = nc25;
Cs(11,56) = nc29;
Cs(11,57) = nc19;
Cs(11,63) = nc13;
Cs(12,1) = nc53;
Cs(12,2) = nc49;
Cs(12,8) = nc43;
Cs(12,41) = nc57;
Cs(12,42) = nc39;
Cs(12,43) = nc35;
Cs(12,44) = nc25;
Cs(12,57) = nc29;
Cs(12,58) = nc19;
Cs(12,64) = nc13;
Cs(13,3) = nc35;
Cs(13,4) = nc25;
Cs(13,9) = nc43;
Cs(13,10) = nc29;
Cs(13,11) = nc19;
Cs(13,15) = nc13;
Cs(13,45) = nc57;
Cs(13,46) = nc53;
Cs(13,47) = nc39;
Cs(13,49) = nc49;
Cs(14,3) = nc49;
Cs(14,10) = nc43;
Cs(14,46) = nc57;
Cs(14,47) = nc53;
Cs(14,48) = nc39;
Cs(14,50) = nc35;
Cs(14,51) = nc25;
Cs(14,59) = nc29;
Cs(14,60) = nc19;
Cs(14,65) = nc13;
Cs(15,3) = nc53;
Cs(15,4) = nc49;
Cs(15,11) = nc43;
Cs(15,49) = nc57;
Cs(15,50) = nc39;
Cs(15,51) = nc35;
Cs(15,52) = nc25;
Cs(15,60) = nc29;
Cs(15,61) = nc19;
Cs(15,66) = nc13;
Cs(16,5) = nc39;
Cs(16,6) = nc49;
Cs(16,7) = nc35;
Cs(16,8) = nc25;
Cs(16,12) = nc43;
Cs(16,13) = nc29;
Cs(16,14) = nc19;
Cs(16,16) = nc13;
Cs(16,53) = nc57;
Cs(16,54) = nc53;
Cs(17,5) = nc53;
Cs(17,7) = nc49;
Cs(17,13) = nc43;
Cs(17,54) = nc57;
Cs(17,55) = nc39;
Cs(17,56) = nc35;
Cs(17,57) = nc25;
Cs(17,62) = nc29;
Cs(17,63) = nc19;
Cs(17,67) = nc13;
Cs(18,6) = nc57;
Cs(18,7) = nc53;
Cs(18,8) = nc49;
Cs(18,14) = nc43;
Cs(18,56) = nc39;
Cs(18,57) = nc35;
Cs(18,58) = nc25;
Cs(18,63) = nc29;
Cs(18,64) = nc19;
Cs(18,68) = nc13;
Cs(19,9) = nc57;
Cs(19,10) = nc53;
Cs(19,11) = nc49;
Cs(19,15) = nc43;
Cs(19,59) = nc39;
Cs(19,60) = nc35;
Cs(19,61) = nc25;
Cs(19,65) = nc29;
Cs(19,66) = nc19;
Cs(19,69) = nc13;
Cs(20,12) = nc57;
Cs(20,13) = nc53;
Cs(20,14) = nc49;
Cs(20,16) = nc43;
Cs(20,62) = nc39;
Cs(20,63) = nc35;
Cs(20,64) = nc25;
Cs(20,67) = nc29;
Cs(20,68) = nc19;
Cs(20,70) = nc13;
Cs(21,6) = nc3;
Cs(21,9) = nc14;
Cs(21,12) = nc1;
Cs(21,17) = nc58;
Cs(21,18) = nc54;
Cs(21,19) = nc40;
Cs(21,22) = nc50;
Cs(21,23) = nc36;
Cs(21,26) = nc26;
Cs(21,32) = nc47;
Cs(21,33) = nc33;
Cs(21,34) = nc11;
Cs(21,37) = nc23;
Cs(21,38) = nc9;
Cs(21,41) = nc5;
Cs(21,45) = nc44;
Cs(21,46) = nc30;
Cs(21,49) = nc20;
Cs(21,53) = nc17;
Cs(21,54) = nc7;
Cs(22,1) = nc5;
Cs(22,3) = nc20;
Cs(22,5) = nc7;
Cs(22,7) = nc3;
Cs(22,10) = nc14;
Cs(22,13) = nc1;
Cs(22,18) = nc58;
Cs(22,19) = nc54;
Cs(22,20) = nc40;
Cs(22,23) = nc50;
Cs(22,24) = nc36;
Cs(22,27) = nc26;
Cs(22,33) = nc47;
Cs(22,34) = nc33;
Cs(22,35) = nc11;
Cs(22,38) = nc23;
Cs(22,39) = nc9;
Cs(22,46) = nc44;
Cs(22,47) = nc30;
Cs(22,54) = nc17;
Cs(23,5) = nc17;
Cs(23,19) = nc58;
Cs(23,20) = nc54;
Cs(23,21) = nc40;
Cs(23,24) = nc50;
Cs(23,25) = nc36;
Cs(23,28) = nc26;
Cs(23,34) = nc47;
Cs(23,35) = nc33;
Cs(23,36) = nc11;
Cs(23,39) = nc23;
Cs(23,40) = nc9;
Cs(23,42) = nc5;
Cs(23,47) = nc44;
Cs(23,48) = nc30;
Cs(23,50) = nc20;
Cs(23,55) = nc7;
Cs(23,56) = nc3;
Cs(23,59) = nc14;
Cs(23,62) = nc1;
Cs(24,1) = nc9;
Cs(24,2) = nc5;
Cs(24,3) = nc30;
Cs(24,4) = nc20;
Cs(24,6) = nc17;
Cs(24,7) = nc7;
Cs(24,8) = nc3;
Cs(24,11) = nc14;
Cs(24,14) = nc1;
Cs(24,22) = nc58;
Cs(24,23) = nc54;
Cs(24,24) = nc40;
Cs(24,26) = nc50;
Cs(24,27) = nc36;
Cs(24,29) = nc26;
Cs(24,37) = nc47;
Cs(24,38) = nc33;
Cs(24,39) = nc11;
Cs(24,41) = nc23;
Cs(24,49) = nc44;
Cs(25,1) = nc23;
Cs(25,3) = nc44;
Cs(25,7) = nc17;
Cs(25,23) = nc58;
Cs(25,24) = nc54;
Cs(25,25) = nc40;
Cs(25,27) = nc50;
Cs(25,28) = nc36;
Cs(25,30) = nc26;
Cs(25,38) = nc47;
Cs(25,39) = nc33;
Cs(25,40) = nc11;
Cs(25,42) = nc9;
Cs(25,43) = nc5;
Cs(25,50) = nc30;
Cs(25,51) = nc20;
Cs(25,56) = nc7;
Cs(25,57) = nc3;
Cs(25,60) = nc14;
Cs(25,63) = nc1;
Cs(26,1) = nc33;
Cs(26,2) = nc23;
Cs(26,4) = nc44;
Cs(26,8) = nc17;
Cs(26,26) = nc58;
Cs(26,27) = nc54;
Cs(26,28) = nc40;
Cs(26,29) = nc50;
Cs(26,30) = nc36;
Cs(26,31) = nc26;
Cs(26,41) = nc47;
Cs(26,42) = nc11;
Cs(26,43) = nc9;
Cs(26,44) = nc5;
Cs(26,51) = nc30;
Cs(26,52) = nc20;
Cs(26,57) = nc7;
Cs(26,58) = nc3;
Cs(26,61) = nc14;
Cs(26,64) = nc1;
Cs(27,3) = nc36;
Cs(27,4) = nc26;
Cs(27,5) = nc11;
Cs(27,6) = nc23;
Cs(27,7) = nc9;
Cs(27,8) = nc5;
Cs(27,9) = nc44;
Cs(27,10) = nc30;
Cs(27,11) = nc20;
Cs(27,12) = nc17;
Cs(27,13) = nc7;
Cs(27,14) = nc3;
Cs(27,15) = nc14;
Cs(27,16) = nc1;
Cs(27,45) = nc58;
Cs(27,46) = nc54;
Cs(27,47) = nc40;
Cs(27,49) = nc50;
Cs(27,53) = nc47;
Cs(27,54) = nc33;
Cs(28,3) = nc50;
Cs(28,5) = nc33;
Cs(28,7) = nc23;
Cs(28,10) = nc44;
Cs(28,13) = nc17;
Cs(28,46) = nc58;
Cs(28,47) = nc54;
Cs(28,48) = nc40;
Cs(28,50) = nc36;
Cs(28,51) = nc26;
Cs(28,54) = nc47;
Cs(28,55) = nc11;
Cs(28,56) = nc9;
Cs(28,57) = nc5;
Cs(28,59) = nc30;
Cs(28,60) = nc20;
Cs(28,62) = nc7;
Cs(28,63) = nc3;
Cs(28,65) = nc14;
Cs(28,67) = nc1;
Cs(29,3) = nc54;
Cs(29,4) = nc50;
Cs(29,6) = nc47;
Cs(29,7) = nc33;
Cs(29,8) = nc23;
Cs(29,11) = nc44;
Cs(29,14) = nc17;
Cs(29,49) = nc58;
Cs(29,50) = nc40;
Cs(29,51) = nc36;
Cs(29,52) = nc26;
Cs(29,56) = nc11;
Cs(29,57) = nc9;
Cs(29,58) = nc5;
Cs(29,60) = nc30;
Cs(29,61) = nc20;
Cs(29,63) = nc7;
Cs(29,64) = nc3;
Cs(29,66) = nc14;
Cs(29,68) = nc1;
Cs(30,6) = nc4;
Cs(30,9) = nc15;
Cs(30,12) = nc2;
Cs(30,17) = nc59;
Cs(30,18) = nc55;
Cs(30,19) = nc41;
Cs(30,22) = nc51;
Cs(30,23) = nc37;
Cs(30,26) = nc27;
Cs(30,32) = nc48;
Cs(30,33) = nc34;
Cs(30,34) = nc12;
Cs(30,37) = nc24;
Cs(30,38) = nc10;
Cs(30,41) = nc6;
Cs(30,45) = nc45;
Cs(30,46) = nc31;
Cs(30,49) = nc21;
Cs(30,53) = nc18;
Cs(30,54) = nc8;
Cs(31,1) = nc6;
Cs(31,3) = nc21;
Cs(31,5) = nc8;
Cs(31,7) = nc4;
Cs(31,10) = nc15;
Cs(31,13) = nc2;
Cs(31,18) = nc59;
Cs(31,19) = nc55;
Cs(31,20) = nc41;
Cs(31,23) = nc51;
Cs(31,24) = nc37;
Cs(31,27) = nc27;
Cs(31,33) = nc48;
Cs(31,34) = nc34;
Cs(31,35) = nc12;
Cs(31,38) = nc24;
Cs(31,39) = nc10;
Cs(31,46) = nc45;
Cs(31,47) = nc31;
Cs(31,54) = nc18;
Cs(32,5) = nc18;
Cs(32,19) = nc59;
Cs(32,20) = nc55;
Cs(32,21) = nc41;
Cs(32,24) = nc51;
Cs(32,25) = nc37;
Cs(32,28) = nc27;
Cs(32,34) = nc48;
Cs(32,35) = nc34;
Cs(32,36) = nc12;
Cs(32,39) = nc24;
Cs(32,40) = nc10;
Cs(32,42) = nc6;
Cs(32,47) = nc45;
Cs(32,48) = nc31;
Cs(32,50) = nc21;
Cs(32,55) = nc8;
Cs(32,56) = nc4;
Cs(32,59) = nc15;
Cs(32,62) = nc2;
Cs(33,1) = nc10;
Cs(33,2) = nc6;
Cs(33,3) = nc31;
Cs(33,4) = nc21;
Cs(33,6) = nc18;
Cs(33,7) = nc8;
Cs(33,8) = nc4;
Cs(33,11) = nc15;
Cs(33,14) = nc2;
Cs(33,22) = nc59;
Cs(33,23) = nc55;
Cs(33,24) = nc41;
Cs(33,26) = nc51;
Cs(33,27) = nc37;
Cs(33,29) = nc27;
Cs(33,37) = nc48;
Cs(33,38) = nc34;
Cs(33,39) = nc12;
Cs(33,41) = nc24;
Cs(33,49) = nc45;
Cs(34,1) = nc24;
Cs(34,3) = nc45;
Cs(34,7) = nc18;
Cs(34,23) = nc59;
Cs(34,24) = nc55;
Cs(34,25) = nc41;
Cs(34,27) = nc51;
Cs(34,28) = nc37;
Cs(34,30) = nc27;
Cs(34,38) = nc48;
Cs(34,39) = nc34;
Cs(34,40) = nc12;
Cs(34,42) = nc10;
Cs(34,43) = nc6;
Cs(34,50) = nc31;
Cs(34,51) = nc21;
Cs(34,56) = nc8;
Cs(34,57) = nc4;
Cs(34,60) = nc15;
Cs(34,63) = nc2;
Cs(35,1) = nc34;
Cs(35,2) = nc24;
Cs(35,4) = nc45;
Cs(35,8) = nc18;
Cs(35,26) = nc59;
Cs(35,27) = nc55;
Cs(35,28) = nc41;
Cs(35,29) = nc51;
Cs(35,30) = nc37;
Cs(35,31) = nc27;
Cs(35,41) = nc48;
Cs(35,42) = nc12;
Cs(35,43) = nc10;
Cs(35,44) = nc6;
Cs(35,51) = nc31;
Cs(35,52) = nc21;
Cs(35,57) = nc8;
Cs(35,58) = nc4;
Cs(35,61) = nc15;
Cs(35,64) = nc2;
Cs(36,3) = nc37;
Cs(36,4) = nc27;
Cs(36,5) = nc12;
Cs(36,6) = nc24;
Cs(36,7) = nc10;
Cs(36,8) = nc6;
Cs(36,9) = nc45;
Cs(36,10) = nc31;
Cs(36,11) = nc21;
Cs(36,12) = nc18;
Cs(36,13) = nc8;
Cs(36,14) = nc4;
Cs(36,15) = nc15;
Cs(36,16) = nc2;
Cs(36,45) = nc59;
Cs(36,46) = nc55;
Cs(36,47) = nc41;
Cs(36,49) = nc51;
Cs(36,53) = nc48;
Cs(36,54) = nc34;
Cs(37,3) = nc51;
Cs(37,5) = nc34;
Cs(37,7) = nc24;
Cs(37,10) = nc45;
Cs(37,13) = nc18;
Cs(37,46) = nc59;
Cs(37,47) = nc55;
Cs(37,48) = nc41;
Cs(37,50) = nc37;
Cs(37,51) = nc27;
Cs(37,54) = nc48;
Cs(37,55) = nc12;
Cs(37,56) = nc10;
Cs(37,57) = nc6;
Cs(37,59) = nc31;
Cs(37,60) = nc21;
Cs(37,62) = nc8;
Cs(37,63) = nc4;
Cs(37,65) = nc15;
Cs(37,67) = nc2;
Cs(38,3) = nc55;
Cs(38,4) = nc51;
Cs(38,6) = nc48;
Cs(38,7) = nc34;
Cs(38,8) = nc24;
Cs(38,11) = nc45;
Cs(38,14) = nc18;
Cs(38,49) = nc59;
Cs(38,50) = nc41;
Cs(38,51) = nc37;
Cs(38,52) = nc27;
Cs(38,56) = nc12;
Cs(38,57) = nc10;
Cs(38,58) = nc6;
Cs(38,60) = nc31;
Cs(38,61) = nc21;
Cs(38,63) = nc8;
Cs(38,64) = nc4;
Cs(38,66) = nc15;
Cs(38,68) = nc2;
Cs(39,9) = nc16;
Cs(39,17) = nc60;
Cs(39,18) = nc56;
Cs(39,19) = nc42;
Cs(39,22) = nc52;
Cs(39,23) = nc38;
Cs(39,26) = nc28;
Cs(39,45) = nc46;
Cs(39,46) = nc32;
Cs(39,49) = nc22;
Cs(40,3) = nc22;
Cs(40,10) = nc16;
Cs(40,18) = nc60;
Cs(40,19) = nc56;
Cs(40,20) = nc42;
Cs(40,23) = nc52;
Cs(40,24) = nc38;
Cs(40,27) = nc28;
Cs(40,46) = nc46;
Cs(40,47) = nc32;
Cs(41,19) = nc60;
Cs(41,20) = nc56;
Cs(41,21) = nc42;
Cs(41,24) = nc52;
Cs(41,25) = nc38;
Cs(41,28) = nc28;
Cs(41,47) = nc46;
Cs(41,48) = nc32;
Cs(41,50) = nc22;
Cs(41,59) = nc16;
Cs(42,3) = nc32;
Cs(42,4) = nc22;
Cs(42,11) = nc16;
Cs(42,22) = nc60;
Cs(42,23) = nc56;
Cs(42,24) = nc42;
Cs(42,26) = nc52;
Cs(42,27) = nc38;
Cs(42,29) = nc28;
Cs(42,49) = nc46;
Cs(43,3) = nc46;
Cs(43,23) = nc60;
Cs(43,24) = nc56;
Cs(43,25) = nc42;
Cs(43,27) = nc52;
Cs(43,28) = nc38;
Cs(43,30) = nc28;
Cs(43,50) = nc32;
Cs(43,51) = nc22;
Cs(43,60) = nc16;
Cs(44,4) = nc46;
Cs(44,26) = nc60;
Cs(44,27) = nc56;
Cs(44,28) = nc42;
Cs(44,29) = nc52;
Cs(44,30) = nc38;
Cs(44,31) = nc28;
Cs(44,51) = nc32;
Cs(44,52) = nc22;
Cs(44,61) = nc16;
Cs(45,6) = nc22;
Cs(45,12) = nc16;
Cs(45,32) = nc60;
Cs(45,33) = nc56;
Cs(45,34) = nc42;
Cs(45,37) = nc52;
Cs(45,38) = nc38;
Cs(45,41) = nc28;
Cs(45,53) = nc46;
Cs(45,54) = nc32;
Cs(46,1) = nc28;
Cs(46,5) = nc32;
Cs(46,7) = nc22;
Cs(46,13) = nc16;
Cs(46,33) = nc60;
Cs(46,34) = nc56;
Cs(46,35) = nc42;
Cs(46,38) = nc52;
Cs(46,39) = nc38;
Cs(46,54) = nc46;
Cs(47,5) = nc46;
Cs(47,34) = nc60;
Cs(47,35) = nc56;
Cs(47,36) = nc42;
Cs(47,39) = nc52;
Cs(47,40) = nc38;
Cs(47,42) = nc28;
Cs(47,55) = nc32;
Cs(47,56) = nc22;
Cs(47,62) = nc16;
Cs(48,1) = nc38;
Cs(48,2) = nc28;
Cs(48,6) = nc46;
Cs(48,7) = nc32;
Cs(48,8) = nc22;
Cs(48,14) = nc16;
Cs(48,37) = nc60;
Cs(48,38) = nc56;
Cs(48,39) = nc42;
Cs(48,41) = nc52;
Cs(49,1) = nc52;
Cs(49,7) = nc46;
Cs(49,38) = nc60;
Cs(49,39) = nc56;
Cs(49,40) = nc42;
Cs(49,42) = nc38;
Cs(49,43) = nc28;
Cs(49,56) = nc32;
Cs(49,57) = nc22;
Cs(49,63) = nc16;
Cs(50,1) = nc56;
Cs(50,2) = nc52;
Cs(50,8) = nc46;
Cs(50,41) = nc60;
Cs(50,42) = nc42;
Cs(50,43) = nc38;
Cs(50,44) = nc28;
Cs(50,57) = nc32;
Cs(50,58) = nc22;
Cs(50,64) = nc16;
Cs(51,3) = nc38;
Cs(51,4) = nc28;
Cs(51,9) = nc46;
Cs(51,10) = nc32;
Cs(51,11) = nc22;
Cs(51,15) = nc16;
Cs(51,45) = nc60;
Cs(51,46) = nc56;
Cs(51,47) = nc42;
Cs(51,49) = nc52;
Cs(52,3) = nc52;
Cs(52,10) = nc46;
Cs(52,46) = nc60;
Cs(52,47) = nc56;
Cs(52,48) = nc42;
Cs(52,50) = nc38;
Cs(52,51) = nc28;
Cs(52,59) = nc32;
Cs(52,60) = nc22;
Cs(52,65) = nc16;
Cs(53,3) = nc56;
Cs(53,4) = nc52;
Cs(53,11) = nc46;
Cs(53,49) = nc60;
Cs(53,50) = nc42;
Cs(53,51) = nc38;
Cs(53,52) = nc28;
Cs(53,60) = nc32;
Cs(53,61) = nc22;
Cs(53,66) = nc16;
Cs(54,5) = nc42;
Cs(54,6) = nc52;
Cs(54,7) = nc38;
Cs(54,8) = nc28;
Cs(54,12) = nc46;
Cs(54,13) = nc32;
Cs(54,14) = nc22;
Cs(54,16) = nc16;
Cs(54,53) = nc60;
Cs(54,54) = nc56;
Cs(55,57) = 1;
Cs(55,71) = -1;
Cs(56,58) = 1;
Cs(56,72) = -1;
Cs(57,60) = 1;
Cs(57,73) = -1;
Cs(58,61) = 1;
Cs(58,74) = -1;
Cs(59,62) = 1;
Cs(59,75) = -1;
Cs(60,14) = 1;
Cs(60,76) = -1;
Cs(61,63) = 1;
Cs(61,77) = -1;
Cs(62,64) = 1;
Cs(62,78) = -1;
Cs(63,15) = 1;
Cs(63,79) = -1;
Cs(64,65) = 1;
Cs(64,80) = -1;
Cs(65,66) = 1;
Cs(65,81) = -1;
Cs(66,16) = 1;
Cs(66,82) = -1;
Cs(67,67) = 1;
Cs(67,83) = -1;
Cs(68,68) = 1;
Cs(68,84) = -1;
Cs(69,69) = 1;
Cs(69,85) = -1;
Cs(70,70) = 1;
Cs(70,86) = -1;
indicesToRemove = [];
indicesToSkip = fliplr(find(sum(transpose(solFromEigenVectors))~=0));
sizeoffinalres =16
[reducedCs, reducedSparseBasis zeroMatrixIndices rowsToRemove colsToRemove] = reducemonbasis(Cs, transpose(solFromEigenVectors),1, 100.0, indicesToSkip);
rowsToRemove = rowsToRemove(1:max(find(rowsToRemove)), :);
colsToRemove = colsToRemove(1:max(find(colsToRemove)), :);
% if(size(rowsToRemove,1) > 0)
if 1 == 2
    indicesToRemove = [rowsToRemove,colsToRemove];
    
    noOfCoeffMatrices = size(Cs,2)/size(Cs,1);
    
    sizeOfReducedCs = sizeOfC - size(rowsToRemove,1);
    sizeOfM22 = size(rowsToRemove,1);
    numberOfCoeffMs = size(Cs,2)/size(Cs,1);
    maxReducedCoeffMs = 2 * numberOfCoeffMs - 1;
    colsToRemove = colsToRemove + ([1:numberOfCoeffMs] - 1) * sizeOfC;
    colsToRemove = colsToRemove(:);
    
    % Estimating M's
    M11 = Cs;
    M11(rowsToRemove,:) =[];
    M11(:,colsToRemove) =[];
    M22 = Cs(rowsToRemove, colsToRemove);
    M12 = Cs(:,colsToRemove);
    M12(rowsToRemove,:) = [];
    M21 = Cs(rowsToRemove,:);
    M21(:,colsToRemove) = [];
    reducedCs = [M11,zeros(sizeOfReducedCs,sizeOfReducedCs*(maxReducedCoeffMs-numberOfCoeffMs))];
    M22 = M22(1:sizeOfM22, 1:sizeOfM22);
    invM22 = inv(M22);
    indxOfZeroCoeffMat = [];
    for i=1:numberOfCoeffMs
        for j=1:numberOfCoeffMs
            coeffExp = i+j-1;
            temp = reducedCs(:,sizeOfReducedCs*(coeffExp-1) + 1:sizeOfReducedCs*coeffExp);
            tempM12 = M12(:,sizeOfM22*(i-1) + 1:sizeOfM22*i);
            tempM21 = M21(:,sizeOfReducedCs*(j-1) + 1:sizeOfReducedCs*j);
            
            buff = temp - (tempM12*invM22) * tempM21;
            reducedCs(:,sizeOfReducedCs*(coeffExp-1) + 1:sizeOfReducedCs*coeffExp) = buff;
            if( norm(buff,'fro') ~= 0)
                indxOfZeroCoeffMat(coeffExp) = 1;
            else
                indxOfZeroCoeffMat(coeffExp) = 0;
            end
        end
    end
    
    allReducedCs = [];
    for i = 1:maxReducedCoeffMs
        buff = reducedCs(:,sizeOfReducedCs*(i-1) + 1:sizeOfReducedCs*i);
        if(indxOfZeroCoeffMat(i) == 1)
            allReducedCs = [allReducedCs, buff];
            
        end
    end
    numOfRedCoeffMat = max(find(indxOfZeroCoeffMat));
    solForm = solFromEigenVectors;
    solForm(indicesToRemove(:,2),:) = [];
    sparseBasis(:,indicesToRemove(:,2)) = [];
    allCss = mat2cell(allReducedCs, sizeOfReducedCs, ones(1,numOfRedCoeffMat) * sizeOfReducedCs);
    
else
    sizeOfReducedCs = sizeOfC;
    numOfRedCoeffMat = size(Cs,2)/size(Cs,1);
    allCss = mat2cell(Cs, sizeOfReducedCs, ones(1,numOfRedCoeffMat ) * sizeOfReducedCs);
    indicesToRemove = [];
end


if rank(allCss{end}) < rank(allCss{1})
    allCss = fliplr(allCss);
end

A = []; B = [];
for i = 1:numOfRedCoeffMat -2
    tempA = []; tempB = [];
    for j = 1:numOfRedCoeffMat - 1
        if j == i + 1
            tempA = [tempA eye(sizeOfReducedCs)];
        else
            tempA = [tempA zeros(sizeOfReducedCs)];
        end
        if j == i
            tempB = [tempB eye(sizeOfReducedCs)];
        else
            tempB = [tempB zeros(sizeOfReducedCs)];
        end
    end
    A = [A;tempA];
    B = [B;tempB];
end

tempA = []; tempB = [];
for j = 1:numOfRedCoeffMat - 1
    tempA = [tempA -allCss{j}];
    if j == numOfRedCoeffMat -1
        tempB = [tempB allCss{j+1}];
    else
        tempB = [tempB zeros(sizeOfReducedCs)];
    end
end
A = [A; tempA];
B = [B; tempB];



extendedbasis = [sparseBasis; zeros(1,sizeOfReducedCs)];
for i = 1:numOfRedCoeffMat-2
    extendedbasis = [extendedbasis, [sparseBasis;ones(1,sizeOfReducedCs)*i]];
end


%% Removal of 0 eigen values via row algebra operations.

perms = [];
zeigvalindx=[];
colpermutation = [];
rowpermutation = [];

% remove_0_eigvalues;
% remove_more_0_eigvalues;


%% Generation of the template to extract solutions to individual
% unhidden variables from the eigen vector which will be a vector
% of monomials, which is an extension of the sparse bases.

% sizeoffinalres = size(extendedbasis,2);
% sizeoffinalres = min(sizeoffinalres, size(extendedbasis,2));
tempextendedbasis = extendedbasis(:,1:sizeoffinalres);
% tempextendedbasis = extendedbasis(:,end-sizeoffinalres+1:end);    
disp(tempextendedbasis);
numerr = 1e-10;

C0 = B; C1 = A;

A1 = -C0(1:end-sizeoffinalres, 1:end-sizeoffinalres);
A2 = -C0(1:end-sizeoffinalres, end-sizeoffinalres+1:end);
B1 = C1(end-sizeoffinalres+1:end, 1:end-sizeoffinalres);
B2 = C1(end-sizeoffinalres+1:end, end-sizeoffinalres+1:end);
X = B2 - (B1/A1) * A2;

[X, nullspacesize, depdXcols, nzrows, depdCcols, indepdCcols, mdepdXcols, mindepdXcols, indepdCrows, rowstorem] = remove_more_0_eigvalues_by_deflation(X);
nullspacesize1=nullspacesize;
depdXcols1=depdXcols;
nzrows1=nzrows;
depdCcols1=depdCcols;
indepdCcols1=indepdCcols;
mdepdXcols1=mdepdXcols;
mindepdXcols1=mindepdXcols;
indepdCrows1=indepdCrows;
rowstorem1=rowstorem;

[X, nullspacesize, depdXcols, nzrows, depdCcols, indepdCcols, mdepdXcols, mindepdXcols, indepdCrows, rowstorem] = remove_more_0_eigvalues_by_deflation(X);
nullspacesize2=nullspacesize;
depdXcols2=depdXcols;
nzrows2=nzrows;
depdCcols2=depdCcols;
indepdCcols2=indepdCcols;
mdepdXcols2=mdepdXcols;
mindepdXcols2=mindepdXcols;
indepdCrows2=indepdCrows;
rowstorem2=rowstorem;

[X, nullspacesize, depdXcols, nzrows, depdCcols, indepdCcols, mdepdXcols, mindepdXcols, indepdCrows, rowstorem] = remove_more_0_eigvalues_by_deflation(X);
nullspacesize3=nullspacesize;
depdXcols3=depdXcols;
nzrows3=nzrows;
depdCcols3=depdCcols;
indepdCcols3=indepdCcols;
mdepdXcols3=mdepdXcols;
mindepdXcols3=mindepdXcols;
indepdCrows3=indepdCrows;
rowstorem3=rowstorem;
    

pairs = transpose(combnk(setdiff(1:size(tempextendedbasis,2), rowstorem),2));

ops = eye(size(tempextendedbasis,1));
solverTemplate = zeros(size(tempextendedbasis));
for i = 1:size(tempextendedbasis,1) -1
    op = ops(:,i);
    for pair = pairs
        tmp = tempextendedbasis(:,pair)* [1;-1];
        if norm(abs(tmp) - op) == 0
            solverTemplate(:,pair(1)) = solverTemplate(:,pair(1)) + sum(tmp) * op;
            solverTemplate(:,pair(2)) = solverTemplate(:,pair(2)) -sum(tmp) * op;
            break;
        end
    end
end
%     Removoing the extended part of the sparseBasis
extendedbasis = tempextendedbasis;
%%


solverTemplate(size(extendedbasis,1),:) = [];

disp(" Parasitic eigenvalues have been removed. And size of final solver is ");
disp(size(extendedbasis));
end
